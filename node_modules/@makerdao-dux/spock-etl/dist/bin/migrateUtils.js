"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.migrateFromConfig = void 0;
const path_1 = require("path");
const postgres_migrations_oasis_1 = require("postgres-migrations-oasis");
const logger_1 = require("../utils/logger");
const logger = logger_1.getLogger('migration');
async function migrateFromConfig(config) {
    await migrate(config.db, 'vulcan2x_core', path_1.join(__dirname, '../../migrate'));
    const migrationNames = Object.keys(config.migrations);
    for (const migration of migrationNames) {
        const migrationDirectory = config.migrations[migration];
        await migrate(config.db, migration, migrationDirectory);
    }
}
exports.migrateFromConfig = migrateFromConfig;
async function migrate(dbConfig, name, dirPath) {
    logger.info(`Migrating ${name}...`);
    try {
        await postgres_migrations_oasis_1.migrate({ ...dbConfig, tableName: `migrations_${name}` }, dirPath);
        logger.info(`Migration for ${name} completed`);
    }
    catch (e) {
        logger.error(`Error while migrating ${name}`);
        throw e;
    }
}
//# sourceMappingURL=migrateUtils.js.map